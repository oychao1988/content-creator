# Content Creator LangGraph å·¥ä½œæµæ¶æ„

## ğŸ“Š å›¾ç»“æ„æ¦‚è§ˆ

è¿™æ˜¯ä¸€ä¸ªåŸºäº LangGraph çš„ AI å†…å®¹åˆ›ä½œå·¥ä½œæµï¼ŒåŒ…å« **6 ä¸ªæ ¸å¿ƒèŠ‚ç‚¹** å’Œ **2 ä¸ªæ¡ä»¶è·¯ç”±**ï¼Œæ”¯æŒè´¨æ£€å¤±è´¥é‡è¯•å’Œæ–­ç‚¹ç»­ä¼ ã€‚

---

## ğŸ¯ æ ¸å¿ƒæµç¨‹å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           Content Creator               â”‚
                    â”‚         LangGraph Workflow              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£  SEARCH (æœç´¢èµ„æ–™)                                           â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  è¾“å…¥: topic (ä¸»é¢˜)                                              â”‚
â”‚  å¤„ç†: ä½¿ç”¨ Tavily API æœç´¢ç›¸å…³èµ„æ–™                              â”‚
â”‚  è¾“å‡º: searchQuery (æœç´¢å…³é”®è¯) + searchResults (æœç´¢ç»“æœ)       â”‚
â”‚  æ£€æŸ¥ç‚¹: âœ… ä¿å­˜çŠ¶æ€                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼ (çº¿æ€§è¾¹)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£  ORGANIZE (æ•´ç†å¤§çº²)                                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  è¾“å…¥: searchResults (æœç´¢ç»“æœ)                                  â”‚
â”‚  å¤„ç†: ä½¿ç”¨ LLM æ•´ç†æˆæ–‡ç« å¤§çº²å’Œå…³é”®ç‚¹                           â”‚
â”‚  è¾“å‡º: organizedInfo (å¤§çº²ã€å…³é”®ç‚¹ã€æ‘˜è¦)                        â”‚
â”‚  æ£€æŸ¥ç‚¹: âœ… ä¿å­˜çŠ¶æ€                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼ (çº¿æ€§è¾¹)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£  WRITE (æ’°å†™å†…å®¹)                                           â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  è¾“å…¥: topic + requirements + organizedInfo                     â”‚
â”‚  å¤„ç†: ä½¿ç”¨ DeepSeek LLM ç”Ÿæˆæ–‡ç« å†…å®¹                           â”‚
â”‚  è¾“å‡º: articleContent (Markdown) + imagePrompts (é…å›¾æç¤ºè¯)    â”‚
â”‚  æ£€æŸ¥ç‚¹: âœ… ä¿å­˜çŠ¶æ€                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼ (çº¿æ€§è¾¹)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£  CHECK_TEXT (æ–‡æœ¬è´¨æ£€)                                       â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  è¾“å…¥: articleContent + hardConstraints                        â”‚
â”‚  å¤„ç†: ç¡¬è§„åˆ™æ£€æŸ¥ + LLM è´¨é‡è¯„ä¼°                                â”‚
â”‚  è¾“å‡º: textQualityReport (è¯„åˆ†ã€æ˜¯å¦é€šè¿‡ã€è¯¦ç»†æŠ¥å‘Š)             â”‚
â”‚  æ£€æŸ¥ç‚¹: âœ… ä¿å­˜çŠ¶æ€                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   æ¡ä»¶è·¯ç”± (Conditional)       â”‚
                       â”‚   routeAfterCheckText()       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                  â”‚                  â”‚
              è´¨æ£€é€šè¿‡ âœ…          è´¨æ£€å¤±è´¥ âŒ        é‡è¯•è¶…é™ âŒ
            (passed=true)      (retry<3)          (retry>=3)
                    â”‚                  â”‚                  â”‚
                    â–¼                  â–¼                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚GENERATE_IMAGEâ”‚    â”‚   WRITE      â”‚    â”‚  æŠ›å‡ºå¼‚å¸¸    â”‚
         â”‚  (ç”Ÿæˆé…å›¾)  â”‚â—€â”€â”€â”€â”‚  (é‡å†™å†…å®¹)  â”‚    â”‚   (å¤±è´¥)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                  â”‚
                    â”‚                                  â–¼
                    â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚  ç»“æŸ (å¤±è´¥)     â”‚
                    â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ï¸âƒ£  GENERATE_IMAGE (ç”Ÿæˆé…å›¾)                                   â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  è¾“å…¥: imagePrompts (æ¥è‡ª Write èŠ‚ç‚¹)                            â”‚
â”‚  å¤„ç†: ä½¿ç”¨ Doubao API ç”Ÿæˆé…å›¾                                  â”‚
â”‚  è¾“å‡º: images (å›¾ç‰‡ URLã€å°ºå¯¸ã€æç¤ºè¯)                          â”‚
â”‚  æ£€æŸ¥ç‚¹: âœ… ä¿å­˜çŠ¶æ€                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼ (çº¿æ€§è¾¹)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6ï¸âƒ£  CHECK_IMAGE (é…å›¾è´¨æ£€)                                      â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  è¾“å…¥: images                                                    â”‚
â”‚  å¤„ç†: æ£€æŸ¥å›¾ç‰‡è´¨é‡å’Œç›¸å…³æ€§                                      â”‚
â”‚  è¾“å‡º: imageQualityReport (è¯„åˆ†ã€æ˜¯å¦é€šè¿‡)                       â”‚
â”‚  æ£€æŸ¥ç‚¹: âœ… ä¿å­˜çŠ¶æ€                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   æ¡ä»¶è·¯ç”± (Conditional)       â”‚
                       â”‚   routeAfterCheckImage()      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                  â”‚                  â”‚
              è´¨æ£€é€šè¿‡ âœ…          è´¨æ£€å¤±è´¥ âŒ        é‡è¯•è¶…é™ âŒ
            (passed=true)      (retry<2)          (retry>=2)
                    â”‚                  â”‚                  â”‚
                    â–¼                  â–¼                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    ç»“æŸ      â”‚    â”‚GENERATE_IMAGEâ”‚    â”‚  æŠ›å‡ºå¼‚å¸¸    â”‚
         â”‚   (æˆåŠŸ)     â”‚â—€â”€â”€â”€â”‚  (é‡æ–°ç”Ÿæˆ)  â”‚    â”‚   (å¤±è´¥)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ å›¾ç»“æ„è¯¦ç»†è¯´æ˜

### 1ï¸âƒ£ **èŠ‚ç‚¹ (Nodes)**

#### **SearchNode** - æœç´¢èµ„æ–™èŠ‚ç‚¹
```typescript
è¾“å…¥: WorkflowState {
  topic: string;
  requirements: string;
}

å¤„ç†:
  - æ ¹æ® topic ç”Ÿæˆæœç´¢å…³é”®è¯
  - è°ƒç”¨ Tavily API æœç´¢ç›¸å…³èµ„æ–™
  - è¿”å›æœç´¢ç»“æœåˆ—è¡¨

è¾“å‡º: Partial<WorkflowState> {
  searchQuery: string;
  searchResults: SearchResultItem[];
  currentStep: 'search';
}
```

#### **OrganizeNode** - æ•´ç†å¤§çº²èŠ‚ç‚¹
```typescript
è¾“å…¥: WorkflowState {
  searchResults: SearchResultItem[];
}

å¤„ç†:
  - ä½¿ç”¨ LLM åˆ†ææœç´¢ç»“æœ
  - ç”Ÿæˆæ–‡ç« å¤§çº² (outline)
  - æå–å…³é”®ç‚¹ (keyPoints)
  - ç”Ÿæˆæ‘˜è¦ (summary)

è¾“å‡º: Partial<WorkflowState> {
  organizedInfo: {
    outline: string;
    keyPoints: string[];
    summary: string;
  };
  currentStep: 'organize';
}
```

#### **WriteNode** - æ’°å†™å†…å®¹èŠ‚ç‚¹
```typescript
è¾“å…¥: WorkflowState {
  topic: string;
  requirements: string;
  organizedInfo: OrganizedInfo;
  hardConstraints: { minWords, maxWords, keywords };
}

å¤„ç†:
  - ä½¿ç”¨ DeepSeek LLM ç”Ÿæˆæ–‡ç« 
  - ç”Ÿæˆé…å›¾æç¤ºè¯ (imagePrompts)
  - ä¿å­˜ä¸Šä¸€ç‰ˆæœ¬ç”¨äºé‡å†™ (previousContent)

è¾“å‡º: Partial<WorkflowState> {
  articleContent: string;
  imagePrompts: string[];
  previousContent: string;
  currentStep: 'write';
}
```

#### **CheckTextNode** - æ–‡æœ¬è´¨æ£€èŠ‚ç‚¹
```typescript
è¾“å…¥: WorkflowState {
  articleContent: string;
  hardConstraints;
  textRetryCount;
}

å¤„ç†:
  1. ç¡¬è§„åˆ™æ£€æŸ¥ (HardRuleChecker):
     - å­—æ•°æ£€æŸ¥ (minWords / maxWords)
     - å…³é”®è¯æ£€æŸ¥ (keywords)
     - ç»“æ„æ£€æŸ¥ (æ ‡é¢˜ã€å¼€å¤´ã€æ­£æ–‡ã€ç»“å°¾)

  2. LLM è´¨é‡è¯„ä¼° (LLMEvaluator):
     - ç›¸å…³æ€§ (relevance)
     - è¿è´¯æ€§ (coherence)
     - å®Œæ•´æ€§ (completeness)
     - å¯è¯»æ€§ (readability)

  3. ç»¼åˆè¯„åˆ† (1-10åˆ†)

è¾“å‡º: Partial<WorkflowState> {
  textQualityReport: {
    score: number;
    passed: boolean;
    hardConstraintsPassed: boolean;
    details: { ... };
    fixSuggestions: string[];
  };
  currentStep: 'checkText';
}
```

#### **GenerateImageNode** - ç”Ÿæˆé…å›¾èŠ‚ç‚¹
```typescript
è¾“å…¥: WorkflowState {
  imagePrompts: string[];
  articleContent: string;
}

å¤„ç†:
  - ä½¿ç”¨ Doubao API ç”Ÿæˆå›¾ç‰‡
  - æ”¯æŒå¤šå¼ å›¾ç‰‡ç”Ÿæˆ
  - ä¿å­˜ä¸Šä¸€ç‰ˆæœ¬ç”¨äºé‡ç”Ÿæˆ (previousImages)

è¾“å‡º: Partial<WorkflowState> {
  images: GeneratedImage[];
  previousImages: GeneratedImage[];
  currentStep: 'generateImage';
}
```

#### **CheckImageNode** - é…å›¾è´¨æ£€èŠ‚ç‚¹
```typescript
è¾“å…¥: WorkflowState {
  images: GeneratedImage[];
  articleContent: string;
  imageRetryCount;
}

å¤„ç†:
  - æ£€æŸ¥å›¾ç‰‡è´¨é‡ (åˆ†è¾¨ç‡ã€æ ¼å¼)
  - æ£€æŸ¥å›¾ç‰‡ç›¸å…³æ€§
  - è¯„åˆ† (1-10åˆ†)

è¾“å‡º: Partial<WorkflowState> {
  imageQualityReport: {
    score: number;
    passed: boolean;
    details: { ... };
  };
  currentStep: 'checkImage';
}
```

---

### 2ï¸âƒ£ **è¾¹ (Edges)**

#### **çº¿æ€§è¾¹ (Linear Edges)**
```
search â†’ organize â†’ write â†’ checkText
generate_image â†’ checkImage
```
æ— æ¡ä»¶æµè½¬ï¼Œé¡ºåºæ‰§è¡Œã€‚

#### **æ¡ä»¶è¾¹ (Conditional Edges)**

**checkText â†’ routeAfterCheckText()**
```typescript
function routeAfterCheckText(state: WorkflowState): string {
  if (state.textQualityReport?.passed) {
    return 'generate_image';  // è´¨æ£€é€šè¿‡ï¼Œç”Ÿæˆé…å›¾
  }

  if (state.textRetryCount < 3) {
    return 'write';  // è´¨æ£€å¤±è´¥ï¼Œé‡è¯•å†™ä½œ
  }

  throw new Error('Text quality check failed after 3 attempts');
}
```

**checkImage â†’ routeAfterCheckImage()**
```typescript
function routeAfterCheckImage(state: WorkflowState): string {
  if (state.imageQualityReport?.passed) {
    return '__end__';  // è´¨æ£€é€šè¿‡ï¼Œç»“æŸæµç¨‹
  }

  if (state.imageRetryCount < 2) {
    return 'generate_image';  // è´¨æ£€å¤±è´¥ï¼Œé‡æ–°ç”Ÿæˆ
  }

  throw new Error('Image quality check failed after 2 attempts');
}
```

---

### 3ï¸âƒ£ **çŠ¶æ€ (State)**

```typescript
interface WorkflowState {
  // è¾“å…¥å‚æ•°
  taskId: string;
  mode: 'sync' | 'async';
  topic: string;
  requirements: string;
  hardConstraints: {
    minWords?: number;
    maxWords?: number;
    keywords?: string[];
  };

  // æµç¨‹æ•°æ® (èŠ‚ç‚¹é—´ä¼ é€’)
  searchQuery?: string;
  searchResults?: SearchResultItem[];
  organizedInfo?: OrganizedInfo;
  articleContent?: string;
  previousContent?: string;      // ç”¨äºé‡å†™
  imagePrompts?: string[];
  images?: GeneratedImage[];
  previousImages?: GeneratedImage[];  // ç”¨äºé‡ç”Ÿæˆ

  // è´¨æ£€æŠ¥å‘Š
  textQualityReport?: QualityReport;
  imageQualityReport?: QualityReport;

  // æ§åˆ¶æ•°æ®
  currentStep: string;
  textRetryCount: number;        // æ–‡æœ¬è´¨æ£€é‡è¯•æ¬¡æ•° (æœ€å¤š3æ¬¡)
  imageRetryCount: number;       // é…å›¾è´¨æ£€é‡è¯•æ¬¡æ•° (æœ€å¤š2æ¬¡)

  // å…ƒæ•°æ®
  version: number;               // ä¹è§‚é”ç‰ˆæœ¬å·
  startTime?: number;
  endTime?: number;
  error?: string;
}
```

---

### 4ï¸âƒ£ **æ£€æŸ¥ç‚¹æœºåˆ¶ (Checkpoint)**

æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œåéƒ½ä¼šä¿å­˜æ£€æŸ¥ç‚¹ï¼š

```typescript
function wrapNodeWithCheckpoint(nodeName, node) {
  return async (state: WorkflowState) => {
    // 1. æ‰§è¡ŒèŠ‚ç‚¹é€»è¾‘
    const result = await node(state);

    // 2. ä¿å­˜æ£€æŸ¥ç‚¹åˆ°å­˜å‚¨ (SQLite/PostgreSQL)
    await checkpointManager.saveCheckpoint(
      state.taskId,
      nodeName,
      { ...state, ...result }
    );

    // 3. è¿”å›ç»“æœ
    return { ...result, currentStep: nodeName };
  };
}
```

**æ–­ç‚¹ç»­ä¼ æµç¨‹ï¼š**
```
1. æ£€æŸ¥ç‚¹ä¿å­˜: æ¯ä¸ªèŠ‚ç‚¹å®Œæˆåä¿å­˜å®Œæ•´çŠ¶æ€
2. å´©æºƒæ¢å¤: ä»æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹æ¢å¤çŠ¶æ€
3. ç»§ç»­æ‰§è¡Œ: ä»å´©æºƒçš„èŠ‚ç‚¹é‡æ–°å¼€å§‹
```

---

## ğŸ”„ é‡è¯•æœºåˆ¶

### **æ–‡æœ¬è´¨æ£€é‡è¯•**
```
å¤±è´¥ â†’ é‡è¯• 1 â†’ å¤±è´¥ â†’ é‡è¯• 2 â†’ å¤±è´¥ â†’ é‡è¯• 3 â†’ å¤±è´¥ â†’ æŠ›å‡ºå¼‚å¸¸
       (write)         (write)         (write)
```

- **æœ€å¤§é‡è¯•æ¬¡æ•°**: 3 æ¬¡
- **é‡è¯•ç­–ç•¥**: é‡æ–°è°ƒç”¨ WriteNode ç”Ÿæˆæ–°å†…å®¹
- **ä¿ç•™å†å²**: previousContent ä¿å­˜ä¸Šä¸€ç‰ˆæœ¬

### **é…å›¾è´¨æ£€é‡è¯•**
```
å¤±è´¥ â†’ é‡è¯• 1 â†’ å¤±è´¥ â†’ é‡è¯• 2 â†’ å¤±è´¥ â†’ æŠ›å‡ºå¼‚å¸¸
       (generate_image)  (generate_image)
```

- **æœ€å¤§é‡è¯•æ¬¡æ•°**: 2 æ¬¡
- **é‡è¯•ç­–ç•¥**: é‡æ–°è°ƒç”¨ GenerateImageNode ç”Ÿæˆæ–°å›¾ç‰‡
- **ä¿ç•™å†å²**: previousImages ä¿å­˜ä¸Šä¸€ç‰ˆæœ¬

---

## ğŸ“Š æ‰§è¡Œæµç¨‹ç¤ºä¾‹

### **æˆåŠŸè·¯å¾„**
```
START
  â†“
search (æœç´¢èµ„æ–™) âœ…
  â†“
organize (æ•´ç†å¤§çº²) âœ…
  â†“
write (æ’°å†™å†…å®¹) âœ…
  â†“
checkText (æ–‡æœ¬è´¨æ£€) âœ… passed=true
  â†“
generate_image (ç”Ÿæˆé…å›¾) âœ…
  â†“
checkImage (é…å›¾è´¨æ£€) âœ… passed=true
  â†“
END (æˆåŠŸå®Œæˆ)
```

### **å¤±è´¥é‡è¯•è·¯å¾„**
```
START
  â†“
... â†’ write (æ’°å†™å†…å®¹) âœ…
  â†“
checkText (æ–‡æœ¬è´¨æ£€) âŒ passed=false, retry=0
  â†“ (æ¡ä»¶è·¯ç”±)
write (é‡å†™å†…å®¹) âœ… retry=1
  â†“
checkText (æ–‡æœ¬è´¨æ£€) âŒ passed=false, retry=1
  â†“ (æ¡ä»¶è·¯ç”±)
write (é‡å†™å†…å®¹) âœ… retry=2
  â†“
checkText (æ–‡æœ¬è´¨æ£€) âœ… passed=true
  â†“
... â†’ END
```

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### **LangGraph ç»„ä»¶**
```typescript
import { StateGraph, END } from '@langchain/langgraph';

// åˆ›å»ºå›¾
const graph = new StateGraph<WorkflowState>({ channels });

// æ·»åŠ èŠ‚ç‚¹
graph.addNode('search', searchNodeFn);
graph.addNode('organize', organizeNodeFn);
graph.addNode('write', writeNodeFn);
graph.addNode('checkText', checkTextNodeFn);
graph.addNode('generate_image', generateImageNodeFn);
graph.addNode('checkImage', checkImageNodeFn);

// è®¾ç½®å…¥å£
graph.setEntryPoint('search');

// æ·»åŠ è¾¹
graph.addEdge('search', 'organize');
graph.addEdge('organize', 'write');
graph.addEdge('write', 'checkText');
graph.addEdge('generate_image', 'checkImage');

// æ·»åŠ æ¡ä»¶è¾¹
graph.addConditionalEdges('checkText', routeAfterCheckText, {
  write: 'write',
  generate_image: 'generate_image',
});

graph.addConditionalEdges('checkImage', routeAfterCheckImage, {
  generate_image: 'generate_image',
  __end__: END,
});

// ç¼–è¯‘å›¾
const compiledGraph = graph.compile();
```

---

## ğŸ¨ å›¾çš„ç±»å‹

### **å®Œæ•´ç‰ˆ (createContentCreatorGraph)**
- âœ… å¸¦æ£€æŸ¥ç‚¹ä¿å­˜
- âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼ 
- âœ… çŠ¶æ€æŒä¹…åŒ–åˆ°æ•°æ®åº“

### **ç®€åŒ–ç‰ˆ (createSimpleContentCreatorGraph)**
- âŒ æ— æ£€æŸ¥ç‚¹
- âœ… æ›´å¿«çš„æ‰§è¡Œé€Ÿåº¦
- âœ… é€‚åˆæµ‹è¯•å’Œç®€å•åœºæ™¯

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

1. **å¹¶è¡Œæ‰§è¡Œ**: æœªæ¥å¯æ”¯æŒå¹¶è¡Œæœç´¢å¤šä¸ªä¸»é¢˜
2. **ç¼“å­˜æœºåˆ¶**: æœç´¢ç»“æœç¼“å­˜ (CacheService)
3. **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šä»»åŠ¡å¹¶å‘æ‰§è¡Œ
4. **èµ„æºç®¡ç†**: è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ•°æ®

---

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### **æ—¥å¿—è®°å½•**
```typescript
logger.info('Executing node: search', { taskId });
logger.info('Routing after check text', { passed, retryCount });
```

### **çŠ¶æ€è¿½è¸ª**
```typescript
currentStep: 'search' | 'organize' | 'write' | 'checkText' | 'generateImage' | 'checkImage'
```

### **é”™è¯¯å¤„ç†**
```typescript
try {
  const result = await node(state);
} catch (error) {
  logger.error(`Node failed: ${nodeName}`, { error });
  throw error;
}
```

---

## ğŸ“ æ€»ç»“

è¿™ä¸ª LangGraph å·¥ä½œæµå®ç°äº†ï¼š

âœ… **6 ä¸ªæ ¸å¿ƒèŠ‚ç‚¹**ï¼šæœç´¢ â†’ æ•´ç† â†’ å†™ä½œ â†’ æ–‡æœ¬è´¨æ£€ â†’ ç”Ÿæˆé…å›¾ â†’ é…å›¾è´¨æ£€
âœ… **2 ä¸ªæ¡ä»¶è·¯ç”±**ï¼šè´¨æ£€å¤±è´¥è‡ªåŠ¨é‡è¯•
âœ… **æ£€æŸ¥ç‚¹æœºåˆ¶**ï¼šæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜çŠ¶æ€ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
âœ… **åŒé‡è´¨æ£€**ï¼šç¡¬è§„åˆ™ + LLM è´¨é‡è¯„ä¼°
âœ… **è‡ªåŠ¨é‡è¯•**ï¼šæ–‡æœ¬æœ€å¤š 3 æ¬¡ï¼Œå›¾ç‰‡æœ€å¤š 2 æ¬¡
âœ… **çŠ¶æ€ç®¡ç†**ï¼šå®Œæ•´çš„çŠ¶æ€ä¼ é€’å’Œæ›´æ–°æœºåˆ¶

è¿™æ˜¯ä¸€ä¸ª**ç”Ÿäº§çº§çš„ AI å†…å®¹åˆ›ä½œå·¥ä½œæµ**ï¼Œå…·å¤‡é«˜å¯é æ€§å’Œå¯æ‰©å±•æ€§ï¼
