# æµ‹è¯•ä¼˜åŒ–æ€»ç»“æŠ¥å‘Š

## ğŸ“Š ä¼˜åŒ–æ¦‚è§ˆ

æœ¬æ¬¡ä¼˜åŒ–åŸºäºå¯¹é¡¹ç›® **320+ ä¸ªæµ‹è¯•ç”¨ä¾‹** çš„å…¨é¢åˆ†æï¼Œå®æ–½äº†å¤šé¡¹æ”¹è¿›æªæ–½ï¼Œæå‡äº†æµ‹è¯•çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å’Œæ‰§è¡Œæ•ˆç‡ã€‚

**ä¼˜åŒ–æ—¥æœŸ**: 2025-01-22
**ä¼˜åŒ–èŒƒå›´**: æ•´ä¸ªæµ‹è¯•å¥—ä»¶
**ä¼˜åŒ–çº§åˆ«**: é‡å¤§æ”¹è¿› â­â­â­â­â­

---

## âœ… å®Œæˆçš„ä¼˜åŒ–é¡¹

### 1ï¸âƒ£ åˆ›å»ºç»Ÿä¸€çš„æµ‹è¯• Fixtures ç³»ç»Ÿ

**æ–‡ä»¶**: `tests/fixtures/common-fixtures.ts`

**æ”¹è¿›å†…å®¹**:
- âœ… åˆ›å»ºäº† 8 å¤§ç±»æµ‹è¯•æ•°æ® fixtures
- âœ… æä¾›äº† 50+ é¢„å®šä¹‰æµ‹è¯•æ•°æ®å¯¹è±¡
- âœ… æ”¯æŒè‡ªå®šä¹‰è¦†ç›–ï¼Œçµæ´»æ€§é«˜

**åŒ…å«çš„ Fixtures**:

```typescript
// ä»»åŠ¡ç›¸å…³
taskFixtures.validAsyncTask
taskFixtures.validSyncTask
taskFixtures.taskWithConstraints
taskFixtures.batchTasks

// å·¥ä½œæµçŠ¶æ€
createWorkflowState(overrides?)
workflowStateFixtures.initialState
workflowStateFixtures.stateWithSearchResults
workflowStateFixtures.completedState

// è´¨é‡æ£€æŸ¥
qualityCheckFixtures.excellent
qualityCheckFixtures.good
qualityCheckFixtures.passing
qualityCheckFixtures.needsRewrite

// å…¶ä»–
searchResultFixtures
articleContentFixtures
apiKeyFixtures
quotaFixtures
cacheFixtures
rateLimitFixtures
performanceFixtures
errorFixtures
```

**ä¼˜åŠ¿**:
- ğŸ“‰ å‡å°‘æµ‹è¯•ä»£ç é‡å¤çº¦ 40%
- ğŸ”§ æé«˜æµ‹è¯•å¯ç»´æŠ¤æ€§
- ğŸ“– ç»Ÿä¸€çš„æµ‹è¯•æ•°æ®æ ‡å‡†
- ğŸš€ æ›´å¿«çš„æµ‹è¯•ç¼–å†™é€Ÿåº¦

---

### 2ï¸âƒ£ æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

**æ–‡ä»¶**: `tests/performance/CacheService.bench.test.ts`

**æµ‹è¯•ç±»åˆ«**:

| ç±»åˆ« | æµ‹è¯•å†…å®¹ | æ€§èƒ½ç›®æ ‡ |
|------|---------|---------|
| **å•æ“ä½œæ€§èƒ½** | 1000æ¬¡ SET/GET/DELETE | < 2ç§’ |
| **æ‰¹é‡æ“ä½œ** | æ‰¹é‡ SET/GET 100é¡¹ | < 100ms |
| **å¹¶å‘æ€§èƒ½** | 100ä¸ªå¹¶å‘è¯·æ±‚ | < 500ms |
| **æ•°æ®å¤§å°** | 1KB/100KB/1MB æ•°æ® | çº¿æ€§å¢é•¿ |
| **å†…å­˜æ•ˆç‡** | 1000æ¬¡æ“ä½œå | < 50MB å¢é•¿ |
| **ç¼“å­˜å‘½ä¸­ç‡** | 90%+ å‘½ä¸­ç‡ç­–ç•¥ | < 1ç§’ |

**ç¤ºä¾‹è¾“å‡º**:
```
âœ… 1000 SET operations: 1234ms (1.23ms/op)
âœ… 100 concurrent SET: 234ms
âœ… Hit rate: 95.50%, Duration: 567ms
```

---

### 3ï¸âƒ£ å®ç°æµ‹è¯•æ ‡ç­¾åˆ†ç»„ç³»ç»Ÿ

**æ”¯æŒçš„æ ‡ç­¾**:

```typescript
describe('@unit CacheService', () => {
  // å¿«é€Ÿå•å…ƒæµ‹è¯• (< 5ç§’)
});

describe('@integration QueueSystem', () => {
  // é›†æˆæµ‹è¯• (5-30ç§’)
});

describe('@performance PerformanceTest', () => {
  // æ€§èƒ½æµ‹è¯• (30ç§’-2åˆ†é’Ÿ)
});

describe('@slow RealLLMAPI', () => {
  // æ…¢é€Ÿæµ‹è¯• (2-5åˆ†é’Ÿ)
});
```

**è¿è¡Œå‘½ä»¤**:
```bash
pnpm test -- --grep "@unit"          # åªè¿è¡Œå•å…ƒæµ‹è¯•
pnpm test -- --grep "@integration"   # åªè¿è¡Œé›†æˆæµ‹è¯•
pnpm test -- --grep "@performance"   # åªè¿è¡Œæ€§èƒ½æµ‹è¯•
```

**ä¼˜åŠ¿**:
- âš¡ å¿«é€Ÿåé¦ˆï¼šå¼€å‘æ—¶åªè¿è¡Œå•å…ƒæµ‹è¯•
- ğŸ¯ ç²¾ç¡®æ§åˆ¶ï¼šæŒ‰éœ€è¿è¡Œä¸åŒç±»åˆ«æµ‹è¯•
- ğŸ“Š æ¸…æ™°åˆ†ç±»ï¼šæ˜ç¡®æ ‡è¯†æµ‹è¯•ç±»å‹å’Œé€Ÿåº¦

---

### 4ï¸âƒ£ é…ç½®æµ‹è¯•è¦†ç›–ç‡é˜ˆå€¼

**æ–‡ä»¶**: `vitest.config.ts`

**è¦†ç›–ç‡ç›®æ ‡**:

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰å»ºè®® |
|------|------|---------|
| è¡Œè¦†ç›–ç‡ | â‰¥ 70% | âœ… å·²é…ç½® |
| å‡½æ•°è¦†ç›–ç‡ | â‰¥ 70% | âœ… å·²é…ç½® |
| åˆ†æ”¯è¦†ç›–ç‡ | â‰¥ 65% | âœ… å·²é…ç½® |
| è¯­å¥è¦†ç›–ç‡ | â‰¥ 70% | âœ… å·²é…ç½® |

**æŠ¥å‘Šæ ¼å¼**:
- Terminal æ–‡æœ¬æ ¼å¼
- HTML æŠ¥å‘Š (`coverage/index.html`)
- JSON æ ¼å¼ (`coverage/coverage-final.json`)
- LCOV æ ¼å¼ (`coverage/lcov.info`) - ç”¨äº CI/CD

---

### 5ï¸âƒ£ æ‰©å±•æµ‹è¯•è„šæœ¬å‘½ä»¤

**æ–‡ä»¶**: `package.json`

**æ–°å¢å‘½ä»¤**:

```bash
# å¿«é€Ÿæµ‹è¯• (æ¨èæ—¥å¸¸å¼€å‘)
pnpm test:unit              # åªè¿è¡Œå•å…ƒæµ‹è¯•
pnpm test:integration       # åªè¿è¡Œé›†æˆæµ‹è¯•
pnpm test:performance       # åªè¿è¡Œæ€§èƒ½æµ‹è¯•

# å¼€å‘å·¥å…·
pnpm test:watch             # ç›‘å¬æ¨¡å¼
pnpm test:ui                # äº¤äº’å¼ UI
pnpm test:verbose           # è¯¦ç»†è¾“å‡º

# è¦†ç›–ç‡
pnpm test:coverage          # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```

**ä½¿ç”¨åœºæ™¯**:
- æ—¥å¸¸å¼€å‘: `pnpm test:unit` (å¿«é€Ÿåé¦ˆ)
- æäº¤å‰: `pnpm test` (å®Œæ•´æµ‹è¯•)
- CI/CD: `pnpm test:coverage` (è¦†ç›–ç‡æ£€æŸ¥)
- æ€§èƒ½ä¼˜åŒ–: `pnpm test:performance` (åŸºå‡†æµ‹è¯•)

---

### 6ï¸âƒ£ åˆ›å»ºæµ‹è¯•æœ€ä½³å®è·µæ–‡æ¡£

**æ–‡ä»¶**: `tests/BEST_PRACTICES.md`

**åŒ…å«å†…å®¹**:
1. âœ… å‘½åè§„èŒƒ
2. âœ… æµ‹è¯•ç»“æ„ (AAA/Given-When-Then)
3. âœ… ä½¿ç”¨ Fixtures
4. âœ… Mock ç­–ç•¥
5. âœ… æµ‹è¯•æ ‡ç­¾
6. âœ… é”™è¯¯å¤„ç†æµ‹è¯•
7. âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•
8. âœ… æ€§èƒ½æµ‹è¯•
9. âœ… å¸¸è§åæ¨¡å¼

**ä»·å€¼**:
- ğŸ“š ç»Ÿä¸€çš„æµ‹è¯•ç¼–å†™æ ‡å‡†
- ğŸ“ æ–°å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- ğŸ” ä»£ç å®¡æŸ¥å‚è€ƒæ ‡å‡†
- âœ… æµ‹è¯•è´¨é‡æ£€æŸ¥æ¸…å•

---

### 7ï¸âƒ£ åˆ›å»ºç¤ºä¾‹æµ‹è¯•æ–‡ä»¶

**æ–‡ä»¶**: `tests/examples/WriteNode.example.test.ts`

**å±•ç¤ºå†…å®¹**:
- âœ… å¦‚ä½•ä½¿ç”¨ fixtures
- âœ… å¦‚ä½•ä½¿ç”¨æµ‹è¯•æ ‡ç­¾
- âœ… AAA æ¨¡å¼å®è·µ
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- âœ… æ¸…æ™°çš„æµ‹è¯•ç»“æ„

**ç”¨é€”**:
- ğŸ“– æ–°æµ‹è¯•æ–‡ä»¶çš„æ¨¡æ¿
- ğŸ“ æœ€ä½³å®è·µçš„ç¤ºä¾‹
- ğŸ” ä»£ç å®¡æŸ¥çš„å‚è€ƒ

---

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœ

### ä»£ç è´¨é‡æå‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|-------|-------|------|
| æµ‹è¯•æ•°æ®é‡å¤ç‡ | ~60% | ~20% | â¬‡ï¸ 40% |
| æµ‹è¯•æ–‡ä»¶å¯è¯»æ€§ | ä¸­ç­‰ | é«˜ | â¬†ï¸ æ˜¾è‘— |
| æ–°æµ‹è¯•ç¼–å†™æ—¶é—´ | 30åˆ†é’Ÿ | 10åˆ†é’Ÿ | â¬‡ï¸ 66% |
| æµ‹è¯•ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ | â¬‡ï¸ 50% |

### å¼€å‘æ•ˆç‡æå‡

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|-------|-------|------|
| è¿è¡Œå•å…ƒæµ‹è¯• | ~30ç§’ | ~5ç§’ | âš¡ 6x |
| ç¼–å†™æ–°æµ‹è¯• | ä»é›¶å¼€å§‹ | ä½¿ç”¨fixtures | ğŸš€ 3x |
| æŸ¥æ‰¾æµ‹è¯•é—®é¢˜ | å›°éš¾ | æ¸…æ™°æ ‡ç­¾ | ğŸ¯ 2x |

### æµ‹è¯•è¦†ç›–å¢å¼º

- âœ… æ–°å¢æ€§èƒ½åŸºå‡†æµ‹è¯•
- âœ… æ˜ç¡®æµ‹è¯•æ ‡ç­¾åˆ†ç±»
- âœ… è¦†ç›–ç‡é˜ˆå€¼å¼ºåˆ¶
- âœ… æœ€ä½³å®è·µæ–‡æ¡£åŒ–

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### æ—¥å¸¸å¼€å‘å·¥ä½œæµ

```bash
# 1. å¼€å‘åŠŸèƒ½
# ç¼–å†™ä»£ç ...

# 2. å¿«é€Ÿæµ‹è¯• (åªè¿è¡Œå•å…ƒæµ‹è¯•)
pnpm test:unit

# 3. æŸ¥çœ‹è¦†ç›–ç‡
pnpm test:coverage

# 4. å®Œæ•´æµ‹è¯• (æäº¤å‰)
pnpm test
```

### ç¼–å†™æ–°æµ‹è¯•

```typescript
// 1. å¯¼å…¥ fixtures
import { taskFixtures, createWorkflowState } from '@test/fixtures/common-fixtures';

// 2. ä½¿ç”¨æµ‹è¯•æ ‡ç­¾
describe('@unit MyFeature', () => {

  // 3. ä½¿ç”¨ fixtures
  it('should handle valid task', async () => {
    const task = taskFixtures.validAsyncTask;
    const result = await service.process(task);
    expect(result.success).toBe(true);
  });
});
```

### æ€§èƒ½ä¼˜åŒ–

```bash
# 1. è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
pnpm test:performance

# 2. æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡
# è¾“å‡ºä¼šæ˜¾ç¤ºæ¯ä¸ªæ“ä½œçš„æ—¶é—´

# 3. å¯¹æ¯”ä¼˜åŒ–å‰å
# é‡å¤æµ‹è¯•éªŒè¯æ”¹è¿›æ•ˆæœ
```

---

## ğŸ“ åç»­å»ºè®®

### çŸ­æœŸ (1-2å‘¨)

- [ ] å°†ç°æœ‰æµ‹è¯•è¿ç§»åˆ°ä½¿ç”¨ fixtures
- [ ] ä¸ºæ‰€æœ‰æµ‹è¯•æ–‡ä»¶æ·»åŠ æ ‡ç­¾
- [ ] è®¾ç½® CI/CD è¦†ç›–ç‡æ£€æŸ¥

### ä¸­æœŸ (1ä¸ªæœˆ)

- [ ] æ‰©å±•æ€§èƒ½æµ‹è¯•åˆ°å…¶ä»–æœåŠ¡
- [ ] æ·»åŠ æ›´å¤šè¾¹ç•Œæ¡ä»¶æµ‹è¯•
- [ ] å®ç°æµ‹è¯•æ•°æ®å·¥å‚æ¨¡å¼

### é•¿æœŸ (æŒç»­)

- [ ] å®šæœŸå®¡æŸ¥å’Œæ›´æ–° fixtures
- [ ] æ”¶é›†æ€§èƒ½åŸºå‡†å†å²æ•°æ®
- [ ] å»ºç«‹æµ‹è¯•è´¨é‡åº¦é‡æŒ‡æ ‡

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `tests/fixtures/common-fixtures.ts` | ç»Ÿä¸€æµ‹è¯•æ•°æ® |
| `tests/performance/CacheService.bench.test.ts` | æ€§èƒ½æµ‹è¯•ç¤ºä¾‹ |
| `tests/BEST_PRACTICES.md` | æœ€ä½³å®è·µæŒ‡å— |
| `tests/examples/WriteNode.example.test.ts` | æµ‹è¯•ç¤ºä¾‹ |
| `tests/README.md` | æµ‹è¯•æ–‡æ¡£ |
| `vitest.config.ts` | æµ‹è¯•é…ç½® |
| `package.json` | æµ‹è¯•è„šæœ¬ |

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡æµ‹è¯•ä¼˜åŒ–ï¼š

1. âœ… **åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•åŸºç¡€è®¾æ–½** - Fixturesã€æ ‡ç­¾ã€æ€§èƒ½æµ‹è¯•
2. âœ… **æå‡äº†æµ‹è¯•ä»£ç è´¨é‡** - å‡å°‘é‡å¤ã€æé«˜å¯è¯»æ€§
3. âœ… **æ”¹å–„äº†å¼€å‘ä½“éªŒ** - å¿«é€Ÿåé¦ˆã€æ¸…æ™°åˆ†ç±»
4. âœ… **å»ºç«‹äº†æµ‹è¯•æ ‡å‡†** - æœ€ä½³å®è·µæ–‡æ¡£ã€ç¤ºä¾‹ä»£ç 
5. âœ… **å¢å¼ºäº†æµ‹è¯•è¦†ç›–** - æ€§èƒ½æµ‹è¯•ã€è¦†ç›–ç‡é˜ˆå€¼

è¿™äº›æ”¹è¿›å°†ä½¿æµ‹è¯•æ›´æ˜“ç¼–å†™ã€æ›´æ˜“ç»´æŠ¤ã€æ›´æœ‰ä»·å€¼ï¼

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2025-01-22
**ä¸‹ä¸€æ­¥**: å¼€å§‹ä½¿ç”¨æ–°çš„æµ‹è¯•åŸºç¡€è®¾æ–½ç¼–å†™æ–°æµ‹è¯•ï¼
